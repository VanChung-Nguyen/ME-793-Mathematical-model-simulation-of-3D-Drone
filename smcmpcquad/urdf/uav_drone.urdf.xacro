<?xml version="1.0" encoding="utf-8"?>
<robot name="drone" xmlns:xacro="http://ros.org/wiki/xacro">
  <link
    name="base_link">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="1.49" />
      <inertia
        ixx="0.0785"
        ixy="0"
        ixz="0"
        iyy="0.0785"
        iyz="0"
        izz="0.105" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/base_link.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 -0.05"
        rpy="0 0 0" />
      <geometry>
         <box size = "0.15 0.15 0.2" />
      </geometry>
    </collision>
  </link>
  <link
    name="propbackright">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="0.09" />
      <inertia
        ixx="0.0004"
        ixy="0"
        ixz="0"
        iyy="0.0004"
        iyz="0"
        izz="0.0004" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_0.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.294117647058824 0.294117647058824 0.294117647058824 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_0.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="pbr"
    type="continuous">
    <origin
      xyz="-0.159 -0.159 0.065"
      rpy="0 0 -1.5708" />
    <parent
      link="base_link" />
    <child
      link="propbackright" />
    <axis
      xyz="0 0 -1" />
  </joint>
  <link
    name="propbackleft">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="0.09" />
      <inertia
        ixx="0.0004"
        ixy="0"
        ixz="0"
        iyy="0.0004"
        iyz="0"
        izz="0.0004" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_1.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.294117647058824 0.294117647058824 0.294117647058824 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_1.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="pbl"
    type="continuous">
    <origin
      xyz="-0.159 0.159 0.065"
      rpy="0 0 -1.5708" />
    <parent
      link="base_link" />
    <child
      link="propbackleft" />
    <axis
      xyz="0 0 -1" />
  </joint>
  <link
    name="propfrontright">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="0.09" />
      <inertia
        ixx="0.0004"
        ixy="0"
        ixz="0"
        iyy="0.0004"
        iyz="0"
        izz="0.0004" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_1.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.294117647058824 0.294117647058824 0.294117647058824 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_1.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="pfr"
    type="continuous">
    <origin
      xyz="0.159 -0.159 0.065"
      rpy="0 0 -1.5708" />
    <parent
      link="base_link" />
    <child
      link="propfrontright" />
    <axis
      xyz="0 0 -1" />
  </joint>
  <link
    name="propfrontleft">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="0.09" />
      <inertia
        ixx="0.0004"
        ixy="0"
        ixz="0"
        iyy="0.0004"
        iyz="0"
        izz="0.0004" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_0.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.294117647058824 0.294117647058824 0.294117647058824 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="file://$(find smcmpcquad)/models/meshes/propeller_0.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="pfl"
    type="continuous">
    <origin
      xyz="0.159 0.159 0.065"
      rpy="0 0 -1.5708" />
    <parent
      link="base_link" />
    <child
      link="propfrontleft" />
    <axis
      xyz="0 0 -1" />
  </joint>
  
  <link name="imu_link">
        <visual>
            <geometry>
                <box size="0.01 0.01 0.01" />
            </geometry>
            <material name="Cyan">
                <color rgba="0 1.0 1.0 1.0" />
            </material>
        </visual>

        <collision>
            <geometry>
                <box size="0.1 0.1 0.1" />
            </geometry>
        </collision>

        <inertial>
            <mass value="0.01" />
            <inertia ixx="0.000001" ixy="0.0" ixz="0.0" iyy="0.000001" iyz="0.0" izz="0.000001" />
        </inertial>
  </link>


 <joint name="imu_joint" type="fixed">
       <parent link="base_link" />
       <child link="imu_link" />
       <origin xyz="0 0 0.05" />
   </joint>  

<gazebo reference="imu_link">
       <sensor name="imu_sensor" type="imu">
           <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
               <ros>
                   <namespace></namespace>
                   <remapping>~/out:=imu</remapping>
               </ros>
               <initial_orientation_as_reference>false</initial_orientation_as_reference>
           </plugin>
           <always_on>true</always_on>
           <update_rate>200</update_rate>
           <visualize>true</visualize>
           <imu>
            <angular_velocity>
              <x>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.003</stddev>          
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>1e-6</bias_stddev>
                </noise>
              </x>
              <y>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.003</stddev>
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>1e-6</bias_stddev>
                </noise>
              </y>
              <z>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.003</stddev>
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>1e-6</bias_stddev>
                </noise>
              </z>
            </angular_velocity>

            <linear_acceleration>
              <x>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.05</stddev>         
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </x>
              <y>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.05</stddev>
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </y>
              <z>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>0.05</stddev>
                  <bias_mean>0.0</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </z>
            </linear_acceleration>
          </imu>
       </sensor>
   </gazebo>

   <link name="camera_frame">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0" />
      <geometry>
        <box size="0.02 0.02 0.02"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0" />
      <geometry>
        <box size="0.02 0.02 0.02"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01" />
      <inertia ixx="0.000001" ixy="0.0" ixz="0.0" iyy="0.000001" iyz="0.0" izz="0.000001" />
    </inertial>
  </link>

  <joint name="camera_joint" type="fixed">
  <parent link="base_link"/>
  <child link="camera_frame"/>
  <origin xyz="0 0 0" rpy="0 1.57079 1.57079"/>
</joint>

<link name="camera_rgb_frame"/>
<joint name="camera_rgb_joint" type="fixed">
  <parent link="camera_frame"/>
  <child link="camera_rgb_frame"/>
  <origin xyz="0 0 0" rpy="0 0 0"/>
</joint>

<gazebo reference="camera_rgb_frame">
  <sensor type="camera" name="oakd_rgb">
    <update_rate>50.0</update_rate>
    <camera name="head">
      <image>
        <width>128</width>
        <height>128</height>
        <format>L8</format>
      </image>
      <clip>
        <near>0.1</near>
        <far>100</far>
      </clip>
      <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.02</stddev>
      </noise>
    </camera>

    <plugin name="camera_rgb_controller" filename="libgazebo_ros_camera.so">
      <alwaysOn>true</alwaysOn>
      <updateRate>50.0</updateRate>
      <cameraName>oakd/rgb</cameraName>
      <imageTopicName>image_raw</imageTopicName>
      <cameraInfoTopicName>camera_info</cameraInfoTopicName>
      <frameName>camera_rgb_frame</frameName>
      <hackBaseline>0.0</hackBaseline>
    </plugin>
  </sensor>
</gazebo>


<gazebo reference="camera_frame">
    <sensor type="ray" name="lidar_sensor">
      <always_on>true</always_on>
      <visualize>false</visualize>
      <update_rate>50</update_rate>

      <ray>
        <scan>
          <horizontal>
            <samples>1</samples>
            <resolution>20</resolution>
            <min_angle>0</min_angle>
            <max_angle>0</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.175</min>
          <max>20.0</max>
          <resolution>0.025</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.02</stddev>
        </noise>
      </ray>

      <plugin name="lidar_ray_plugin" filename="libgazebo_ros_ray_sensor.so">
        <ros>
          <remapping>~/out:=/lidar_distance</remapping>
        </ros>
        <output_type>sensor_msgs/Range</output_type>
        <frame_name>camera_frame</frame_name>
        <radiation_type>infrared</radiation_type>  
      </plugin>
    </sensor>
</gazebo>

  <gazebo>
    <plugin name="gazebo_ros_state" filename="libgazebo_ros_p3d.so">
      <ros>
        <namespace>/droneposition</namespace>
      </ros>
      <update_rate>200</update_rate> 
      <body_name>base_link</body_name> 
      <frame_name>world</frame_name>
    </plugin>
  </gazebo>
  
  <gazebo>
  <plugin name="uavplugin" filename="/home/vanchung/ros2_ws/install/smcmpcquad/lib/smcmpcquad/libuavplugin.so">
      <updateRate>200</updateRate> 
      <publishTf>true</publishTf>
      <rotorThrustCoeff>0.00025</rotorThrustCoeff>
      <rotorTorqueCoeff>0.000075</rotorTorqueCoeff>
    </plugin>
  </gazebo>

</robot>